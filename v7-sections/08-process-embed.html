<script>
window.AV=window.AV||{};
window.AV.process=function(){
var timeline=document.querySelector('.process-timeline');
var lineEl=document.querySelector('.process-line');
var lineFill=document.querySelector('.process-line-fill');
var steps=document.querySelectorAll('.process-step');
var dots=document.querySelectorAll('.process-step-dot');

if(!timeline||!lineFill||dots.length<2)return;

function alignLine(){
var tRect=timeline.getBoundingClientRect();
var firstDot=dots[0].getBoundingClientRect();
var lastDot=dots[dots.length-1].getBoundingClientRect();
var topPx=firstDot.top+firstDot.height/2-tRect.top;
var botPx=lastDot.top+lastDot.height/2-tRect.top;
lineEl.style.setProperty('--line-top',topPx+'px');
lineEl.style.setProperty('--line-h',(botPx-topPx)+'px');
return botPx-topPx;
}
var lineH=alignLine();
window.addEventListener('resize',alignLine);

gsap.to(lineFill,{
height:lineH,
ease:'none',
scrollTrigger:{
trigger:timeline,
start:'top 60%',
end:'bottom 40%',
scrub:1,
invalidateOnRefresh:true
}
});

var numbers=document.querySelectorAll('.process-step-number');

steps.forEach(function(step,i){
var title=step.querySelector('.process-step-title');
var body=step.querySelector('.process-step-body');

if(title){
gsap.from(title,{
y:30,opacity:0,duration:1,ease:'power3.out',
scrollTrigger:{trigger:step,start:'top 75%'}
});
}

if(body){
gsap.from(body,{
y:20,opacity:0,duration:1,delay:0.15,ease:'power3.out',
scrollTrigger:{trigger:step,start:'top 75%'}
});
}

if(numbers[i]){
gsap.from(numbers[i],{
opacity:0,scale:0.8,duration:1.2,ease:'power3.out',
scrollTrigger:{trigger:step,start:'top 75%'}
});
}

if(dots[i]){
ScrollTrigger.create({
trigger:step,
start:'top 60%',
onEnter:function(){dots[i].classList.add('active')},
onLeaveBack:function(){dots[i].classList.remove('active')}
});
}
});
};
</script>
